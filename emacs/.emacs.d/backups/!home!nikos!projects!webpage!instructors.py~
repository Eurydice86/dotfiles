import groups

import datetime
import requests
import json
import os

import member

from dotenv import load_dotenv

load_dotenv()

def weapon_to_group(weapon):
    conversion_table = {
        "Bolognese Sidesword": "38877",
        "Fiore": "60894",
        "Gekiken": "38881",
        "Wrestling": "38880",
        "German Longsword": "38876",
        "Sabre": "38879",
        "Rapier": "38878",
    }
    
    return conversion_table[weapon]


def members(weapon):

    group = weapon_to_group(weapon)
    
    myclub_token = os.getenv("MC_TOKEN")
    headers = {"X-myClub-token": myclub_token}

    base_url = "https://ehms.myclub.fi/api/"
    event_url = f"groups/{group}/memberships"
    full_url = base_url + event_url

    memberships = json.loads(requests.get(full_url, headers=headers).content)

    instructors = []
    for m in memberships:
        instructors.append(m["membership"]["member_id"])

    return instructors


def instructors_info(weapon):
    instuctors = members(weapon)

    instuctors_list = []
    for i in instuctors:
        instuctors_list.append(member.member(str(i)))
        
    return instuctors_list
if __name__=="__main__":
    for i in instructors_info("German Longsword"):
        print(json.dumps(i, indent=2))
